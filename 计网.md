# 一、物理层

## 1.信道复用技术

​	频分复用：所有用户在同样时间占用不同带宽资源

​	时分复用：所有用户在不同时间占用同样频带宽度

![image-20200315123600689](%E8%AE%A1%E7%BD%91.assets/image-20200315123600689.png)

​	统计时分复用：使用集中器将用户数据集中后使用高速线路发送

​	波分复用：光的频分复用

​	码分复用：

# 二、数据链路层

​	把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层

(1) 结点A的数据链路层把网络层交下来的IP数据报添加首部和尾部封装成帧。

(2) 结点A把封装好的帧发送给结点B的数据链路层。

(3) 若结点B的数据链路层收到的帧无差错，则从收到的帧中提取出IP数据报上交给上面的网络层；否则丢弃这个帧。

​	封装成帧，透明传输，差错检验

## 1. PPP协议

​	点对点通信

![image-20200316145452199](%E8%AE%A1%E7%BD%91.assets/image-20200316145452199.png)

![image-20200316150946506](%E8%AE%A1%E7%BD%91.assets/image-20200316150946506.png)

​	首位为标志字段，协议部分标识IP数据报或网络层的控制信息或。。。

​	FCS：是使用CRC的帧检验序列FCS

​	当ip数据报中出现标志信息时使用字节填充进行转义

​	0比特填充：PPP协议用在SONET/SDH链路时，是使用同步传输（一连串的比特连续传送）而不是异步传输（逐个字符地传送）。在这种情况下，PPP协议采用零比特填充方法来实现透明传输。

​		在发送端扫描整个信息字段，若出现连续5个1则添加一个0，避免出现连续6个1，接收端在收到信息字段后，若出现连续5个1，则去掉下一位0

​	适配器：

​		适配器接收和发送各种帧时不使用计算机的CPU。这时CPU可以处理其他任务。**当适配器收到有差错的帧时**，就把这个帧丢弃而不必通知计算机。**当适配器收到正确的帧时**，它就使用中断来通知该计算机并交付协议栈中的网络层。当计算机要发送IP数据报时，就由协议栈把IP数据报向下交给适配器，组装成帧后发送到局域网。

![image-20200316165903069](%E8%AE%A1%E7%BD%91.assets/image-20200316165903069.png)

## 2. CSMA/CD协议

​	载波监听多点接入/碰撞检测

​	以太网采用随机接入，故需要解决碰撞问题

1. 多点接入，总线型的网路，许多计算机以多点接入的方式连接在一根总线上。协议的实质是“载波监听”和“碰撞检测”。
2. 载波监听，检测信道有没有其他计算机在发送信息
3. 碰撞检测，边发送边监听，即适配器边发送数据边检测信道上的信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。若出现碰撞则适配器立即停止发送，避免继续无效发送浪费网络资源。

要点：

​	(1) 准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部（见本章的3.4.3节），组成以太网帧，放入适配器的缓存中。但在发送之前，必须先检测信道。

​	(2) 检测信道：若检测到信道忙，则应不停地检测，一直等待信道转为空闲。若检测到信道空闲，并在96比特时间内信道保持空闲（保证了帧间最小间隔），就发送这个帧。

​	(3) 在发送过程中仍不停地检测信道，即网络适配器要边发送边监听。这里只有两种可能性：

​		一是发送成功：在争用期内一直未检测到碰撞。这个帧肯定能够发送成功。发送完毕后，其他什么也不做。然后回到(1)。

​		二是发送失败：在争用期内检测到碰撞。这时立即停止发送数据，并按规定发送人为干扰信号。适配器接着就执行指数退避算法，等待 r倍512比特时间后，返回到步骤(2)，继续检测信道。但若重传达16次仍不能成功，则停止重传而向上报错。

​	以太网每发送完一帧，一定要把已发送的帧暂时保留一下。如果在争用期内检测出发生了碰撞，那么还要在推迟一段时间后再把这个暂时保留的帧重传一次。

MAC帧：

![image-20200316181042962](%E8%AE%A1%E7%BD%91.assets/image-20200316181042962.png)

## 3.扩展以太网

​	网桥：将多个以太网连接起来，每一个接口连接一个以太网，负责不同以太网之间信息的传递

​	好处：

1. 过滤通信量，增大吞吐量
2. 扩大了物理范围
3. 提高了可靠性
4. 可互连不同的物理层，不同的MAC子层，不同速率的以太网



​	以太网交换机=多接口网桥

# 三、网络层

​	网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务

## 1.IP协议

​	IP地址是标识一个主机和一条链路的接口，当一个主机连接到多个网络上时就应该有多个IP地址，其网络号不同，例如路由器就是一种多归属主机。



IP协议与

​	● 地址解析协议ARP (Address Resolution Protocol)

​	● 网际控制报文协议ICMP (Internet Control Message Protocol)

​	● 网际组管理协议IGMP (Internet Group Management Protocol)

配套使用

​	网络层使用路由器作为中间设备

![image-20200316204718271](%E8%AE%A1%E7%BD%91.assets/image-20200316204718271.png)

1. A类地址网络号最高位默认0，剩下七位除全0与全1，全0代表本网络，全1为本地软件环回测试
2. B类网络号前两位默认10，剩下的2^14，而从128.1开始指派，故2^14-1
3. C类理同B

![image-20200316205555523](%E8%AE%A1%E7%BD%91.assets/image-20200316205555523.png)

## 2.ARP协议

​	**ARP是解决同一个局域网上的主机或路由器的IP地址和硬件地址的映射问题**

​	IP地址->MAC地址，在主机ARP高速缓存中放一个IP到硬件的映射表，且进行动态更新

​	当主机A需要知道主机B的硬件地址时，首先在本机高速缓存中查找有无B的记录，找不到则在该机所在局域网中广播一个ARP请求分组，例：“我的IP地址是209.0.0.5，硬件地址是00-00-C0-15-AD-18。我想知道IP地址为209.0.0.6的主机的硬件地址。”

​	本局域网上的所有主机运行的ARP进程都会受到该请求分组

​	主机B发现这个请求正是自己的IP地址，于是给A传一个响应信息

​	A受到响应信息，将该记录写入本机ARP高速缓存中

![image-20200316215230667](%E8%AE%A1%E7%BD%91.assets/image-20200316215230667.png)

## 3.IP数据报

![image-20200316215410578](%E8%AE%A1%E7%BD%91.assets/image-20200316215410578.png)

由首部与数据两部分组成。

1. 版本，四位，IP协议版本，通信双方IP协议需一致，IPv4，IPv6

2. 首部长度，四位，单位为32位字（4字节），也即允许的最小值为5,5*4=20字节（即可变部分为0的情况），故首部长度一定为4的倍数

3. 区分服务，8位

4. 总长度，16位，首部+数据的长度

5. 标识，16位，计数器赋值

6. 标志，3位，

    ● 标志字段中的最低位记为MF (More Fragment)。MF = 1即表示后面“还有分片”的数据报。MF = 0表示这已是若干数据报片中的最后一个。

    ● 标志字段中间的一位记为DF (Don't Fragment)，意思是“不能分片”。只有当DF = 0时才允许分片。

7. 片偏移，13位，较长分组分片后，某片在原分组中的相对位置。片偏移以8个字节为偏移单位

8. 生存时间，8位，数据报在网络中的寿命，指明数据报在因特网中至多可以经过多少个路由器

9. 协议，8位，协议字段指出此数据报携带的数据是使用何种协议，以便使目的主机的IP层知道应将数据部分上交给哪个处理过程。![image-20200316221304561](%E8%AE%A1%E7%BD%91.assets/image-20200316221304561.png)

10. 首部校验和，16位，只检验数据报的首部，但不包括数据部分

11. 源地址

12. 目的地址

路由表中存着 目的网络地址，下一跳地址

![image-20200316232430930](%E8%AE%A1%E7%BD%91.assets/image-20200316232430930.png)

## 4.划分子网

​	借用一部分主机号作子网号

​	三级地址，![image-20200317104457274](%E8%AE%A1%E7%BD%91.assets/image-20200317104457274.png)

​	划分子网属于一个网络内部的划分，对外仍是一个整体网络

​	子网掩码：一串连续的1的二进制01串，与IP地址相与后可以得到具体的网络号，子网号；若不进行子网划分，则默认子网掩码即为ABC类地址网络号位数的1。

​	在引入了划分子网后，分组转发算法进行更改，路由表需包含：**目的网络地址、子网掩码和下一跳地址。**

(1) 从收到的数据报的首部**提取目的IP地址D**。

(2) 先**判断是否为直接交付**。**对路由器直接相连的网络逐个进行检查**：**用各网络的子网掩码和 D逐位相“与”**（AND操作），看结果是否和相应的网络地址匹配。若匹配，则把分组进行直接交付（当然还需要把 D 转换成物理地址，把数据报封装成帧发送出去），转发任务结束。否则就是间接交付，执行(3)。

(3) 若路由表中**有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器**；否则，执行(4)。

(4) **对路由表中的每一行**（目的网络地址，子网掩码，下一跳地址），用其中的子网掩码和D逐位相“与”（AND操作），其结果为N。若N与该行的目的网络地址匹配，则把数据报传送给该行指明的下一跳路由器；否则，执行(5)。

(5) 若路由表中有一个**默认路由**，则把数据报传送给路由表中所指明的默认路由器；否则，执行(6)。

(6) 报告转发分组出错。

CIDR：网络前缀，主机号

![image-20200317111712904](%E8%AE%A1%E7%BD%91.assets/image-20200317111712904.png)

/后面的数字即表示网络前缀的位数

路由表中存储  网络前缀与下一跳

遵循最长匹配原则，二叉线索树（01字典树）

## 5.网际控制报文协议ICMP

​	为了更有效地转发IP数据报和提高交付成功的机会

![image-20200317113707422](%E8%AE%A1%E7%BD%91.assets/image-20200317113707422.png)

# 四、运输层

## 1.UDP协议

1. 无连接
2. 尽最大努力交付
3. 面向报文
4. 没有拥塞控制
5. 支持一对一、多，多对一、多
6. 首部开销小

![image-20200324151226017](%E8%AE%A1%E7%BD%91.assets/image-20200324151226017.png)

计算校验和时，在UDP数据报前加12字节的伪首部，伪首部既不向下传送也不向上递交，仅为了计算校验和。

## 2.TCP协议

![image-20200324152054394](%E8%AE%A1%E7%BD%91.assets/image-20200324152054394.png)

